(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{755:function(s,a,n){"use strict";n.r(a);var t=n(103),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("blockquote",[n("p",[n("strong",[s._v("信息收集的深度，直接关系到内网渗透测试结果的成败")])])]),s._v(" "),n("p",[n("strong",[s._v("进入内网后，红队专家一般会在本机以及内部网络 开展进一步信息收集和情报刺探工作。")])]),s._v(" "),n("p",[s._v("包括收集当前 计算机的网络连接、进程列表、命令执行历史记录、 数据库信息、当前用户信息、管理员登录信息、总结 密码规律、补丁更新频率等信息；")]),s._v(" "),n("p",[s._v("同时对内网的其他 计算机或服务器的IP、主机名、开放端口、开放服务、 开放应用等情况进行情报刺探。")]),s._v(" "),n("p",[s._v("再利用内网计算机、 服务器不及时修复漏洞、不做安全防护、同口令等弱 点来进行横向渗透扩大战果。")]),s._v(" "),n("p",[s._v("对于含有域的内网，红队专家会在扩大战果的同时 去寻找域管理员登录的蛛丝马迹。")]),s._v(" "),n("p",[s._v("一旦发现某台服务 器有域管理员登录，就可以利用Mimikatz等工具去尝 试获得登录账号密码明文，或者Hashdump工具去导出 NTLM哈希，继而实现对域控服务器的渗透控制。")]),s._v(" "),n("p",[s._v("在内网漫游过程中，红队专家会重点关注邮件服务 器权限、OA系统权限、版本控制服务器权限、集中运维管理平台权限、统一认证系统权限、域控权限等位 置，尝试突破核心系统权限、控制核心业务、获取核心数据，最终完成目标突破工作。")]),s._v(" "),n("h1",{attrs:{id:"本机信息收集"}},[s._v("本机信息收集 "),n("a",{staticClass:"header-anchor",attrs:{href:"#本机信息收集"}},[s._v("#")])]),s._v(" "),n("p",[n("strong",[s._v("用户权限")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("whoami")]),s._v(" /all    \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查当前用户在目标系统中的具体权限")]),s._v("\n\nquery user   \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查当前机器中正在线的用户,注意管理员此时在不在")]),s._v("\n\nnet user        \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查当前机器中所有的用户名")]),s._v("\n\nnet localgroup\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查当前机器中所有的组名,了解不同组的职能,如,IT,HR,ADMIN,FILE")]),s._v("\n\nnet localgroup "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Administrators"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查指定组中的成员列表")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[n("strong",[s._v("系统基本信息")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("ipconfig /all    \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取本机网络配置")]),s._v("\n\nsysteminfo\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看系统的基本信息（系统版本、软件及补丁的安装情况）")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" %PROCESSOR_ARCHITECTURE%    \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可查看系统的体系结构，是x86还是AMD64等")]),s._v("\n\ntasklist\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看本机进程列表，分析是否存在VPN杀软等进程")]),s._v("\n\nwmic servcie list brief    \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看本机服务信息")]),s._v("\n\nwmic startup get command,caption    \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看程序启动信息")]),s._v("\n\nschtasks /query /fo LIST /v\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看系统计划任务")]),s._v("\n\nnet statistics workstation\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看主机开机时间")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("p",[n("strong",[s._v("网络信息")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -ano\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看本机所有的tcp,udp端口连接及其对应的pid")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -anob   \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看本机所有的tcp,udp端口连接,pid及其对应的发起程序")]),s._v("\n\nnet share\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看本机共享列表，和可访问的域共享列表")]),s._v("\n\nwmic share get name,path,status\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#利用wmic查找共享列表")]),s._v("\n\nroute print\narp -a\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看路由表和arp缓存")]),s._v("\n\nREG QUERY "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看代理配置情况")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("wmic，Windows管理工具，提供了从命令行接口和批命令脚本执行系统管理的支持。自xp之后系统自带")]),s._v(" "),n("p",[n("strong",[s._v("防火墙的信息和配置（配置防火墙需要管理员权限）")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("netsh advfirewall firewall    \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看防火墙配置")]),s._v("\n\nnetsh firewall "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" opmode disable\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关闭防火墙，Server 2003及之前的版本")]),s._v("\n\nnetsh advfirewall "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" allprofiles state off\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关闭防火墙，Server 2003之后的版本")]),s._v("\n\nnetsh firewall "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" allowedprogram c:"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("nc.exe "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"allow nc"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Server 2003及之前的版本允许指定程序的全部连接")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Server 2003之后的版本")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许入站")]),s._v("\nnetsh advfirewall firewall "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" rule "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pass nc"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dir")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("in "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("action")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("allow "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("program")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"c:'),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('c.exe"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许出站")]),s._v("\nnetsh advfirewall firewall "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" rule "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Allow nc"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dir")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("out "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("action")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("allow "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("program")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"c:'),n("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('c.exe"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3389端口放行")]),s._v("\nnetsh advfirewall firewall "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" rule "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remote Desktop"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("protocol")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("TCP "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dir")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("in "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("localport")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3389")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("action")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("allow\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#自定义防火墙日志存储位置")]),s._v("\nnetsh advfirewall "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" currentprofile logging filename "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"c:\\windows'),n("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[s._v("\\t")]),s._v("emp"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\f"}},[s._v("\\f")]),s._v('w.log"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("p",[n("strong",[s._v("操作当前机器的远程桌面连接服务（开启和关闭rdp，需要管理员权限）")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("wmic RDTOGGLE WHERE "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ServerName")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%COMPUTERNAME%'")]),s._v(" call SetAllowTSConnections "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启")]),s._v("\n\nwmic RDTOGGLE WHERE "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ServerName")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%COMPUTERNAME%'")]),s._v(" call SetAllowTSConnections "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关闭")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下边的命令查询RDP服务的端口，返回一个十六进制的端口")]),s._v("\nREG QUERY "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp"')]),s._v(" /V PortNumber\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h1",{attrs:{id:"主机发现"}},[s._v("主机发现 "),n("a",{staticClass:"header-anchor",attrs:{href:"#主机发现"}},[s._v("#")])]),s._v(" "),n("p",[n("strong",[s._v("基于ARP")])]),s._v(" "),n("p",[s._v("arp可以轻易bypass掉各类应用层防火墙，除非是专业的arp防火墙")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" netdiscover -r "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".2.0/16 -i eth0 \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Linux下推荐使用，kali自带，通过端口转发或边界代理")]),s._v("\n\narp-scan.exe -t "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".2.0/24\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Windows下推荐使用，上传到目标主机")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("arp-scan.exe下载地址：https://github.com/QbsuranAlang/arp-scan-windows-")]),s._v(" "),n("p",[n("strong",[s._v("基于ICMP")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" /L %I "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1,1")]),s._v(",254"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" DO @ping -w "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" -n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".2.%I "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" findstr "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TTL="')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("SPN扫描服务")])]),s._v(" "),n("p",[s._v("每个重要的服务在域中都有对用的SPN，所以不必使用端口扫描，只需利用SPN扫描就能找到大部分应用服务器")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看当前域内的所有SPN（系统命令）")]),s._v("\nsetspn -q */*\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("使用PowerShell-AD-Recon脚本")]),s._v(" "),n("p",[s._v("PowerShell-AD-Recon：https://github.com/PyroTek3/PowerShell-AD-Recon")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("powershell -nop -exec bypass -c "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"& {Import-Module '.\\Discover-PSInterestingServices.ps1';Discover-PSInterestingServices}\"")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("nmap端口扫描（上边界代理）")])]),s._v(" "),n("p",[s._v("一般前边的方法能用，就不用代理扫")]),s._v(" "),n("p",[s._v("如果上代理扫没被封"),n("code",[s._v("IP")]),s._v("的话可以尝试"),n("code",[s._v("Goby")]),s._v("资产梳理一波（谨慎使用）")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("proxychains nmap -T4 -A "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".1.0/24\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("基于MSF的服务发现（上代理）")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ARP")]),s._v("\nauxiliary/scanner/discovery/arp_sweep\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#UDP")]),s._v("\nauxiliary/scanner/discovery/udp_sweep\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#HTTP服务发现")]),s._v("\nauxiliary/scanner/http/http_version\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#SMB服务发现")]),s._v("\nuse auxiliary/scanner/smb/smb_version\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[n("strong",[s._v("寻找原则：尽量不做大规模扫描（防止被踢出内网）")])]),s._v(" "),n("ol",[n("li",[s._v("Hosts文件（看域名绑定）")]),s._v(" "),n("li",[s._v("各类history\n"),n("ol",[n("li",[s._v("Bash")]),s._v(" "),n("li",[s._v("ssh know_hosts")]),s._v(" "),n("li",[s._v("浏览器历史  https://xenarmor.com/password-secrets-of-popular-web-browsers/")])])]),s._v(" "),n("li",[s._v("各类配置文件\n"),n("ol",[n("li",[s._v("Zabbix（找到server位置，用默认密码去碰内网设备）")]),s._v(" "),n("li",[s._v("主机edr配置文件")])])]),s._v(" "),n("li",[s._v("PAC列表（Windows上代理出网，里面会写全内网所有主机域名）")]),s._v(" "),n("li",[s._v("DNS查询\n"),n("ol",[n("li",[s._v("直接指定DNS服务器为内网DNS，通过域名爆破工具查询")]),s._v(" "),n("li",[s._v("域传送在内网很常见")])])]),s._v(" "),n("li",[s._v("arp表（周围存活主机）")])]),s._v(" "),n("h1",{attrs:{id:"域信息收集"}},[s._v("域信息收集 "),n("a",{staticClass:"header-anchor",attrs:{href:"#域信息收集"}},[s._v("#")])]),s._v(" "),n("p",[n("strong",[s._v("判断主域（定位域控）")])]),s._v(" "),n("p",[s._v("原理：域服务器通常会同时作为时间服务器使用")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("net "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" /domain\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("域基本信息查询")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("net view /domain            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查询所有域")]),s._v("\nnet view /domain:WINTRYSEC  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查询域内所有主机")]),s._v("\nnet group /domain           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查询域内所有用户组")]),s._v("\nnet group "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"domain computers"')]),s._v(" /domain  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查询域成员计算机列表")]),s._v("\nnet accounts /domain        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取域密码策略")]),s._v("\nnltest /domain_trusts       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#获取域信任信息")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[n("strong",[s._v("获取域内用户和管理员信息")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("net user /domain                     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查询域内用户列表（需要使用域账户查询）")]),s._v("\nnet group "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"domain admins"')]),s._v(" /domain    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查询域管理员用户（需要使用域账户查询）")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("strong",[s._v("定位域管理员")])]),s._v(" "),n("p",[s._v("获取域内一个支点后需要获取域管理员权限。")]),s._v(" "),n("p",[s._v("域管理员有其它域成员主机的本地系统管理员权限，具备完全控制权。")]),s._v(" "),n("p",[s._v("推荐使用**"),n("code",[s._v("Empire")]),n("strong",[s._v("的")]),n("code",[s._v("user_hunter")]),s._v("**模块")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("usemodule situational_awareness/network/powerview/user_hunterexecute\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以清楚的看到哪个用户登录了哪个主机")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);