(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{771:function(t,s,a){"use strict";a.r(s);var n=a(103),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"任意文件下载漏洞"}},[t._v("任意文件下载漏洞 "),a("a",{staticClass:"header-anchor",attrs:{href:"#任意文件下载漏洞"}},[t._v("#")])]),t._v(" "),a("p",[t._v("一些网站由于业务需求，往往需要提供文件查看或文件下载功能，若对用户查看或下载的文件限制不严")]),t._v(" "),a("p",[t._v("则用户就能够查看或下载任意敏感文件，这就是文件下载漏洞。")]),t._v(" "),a("h2",{attrs:{id:"漏洞利用"}},[t._v("漏洞利用 "),a("a",{staticClass:"header-anchor",attrs:{href:"#漏洞利用"}},[t._v("#")])]),t._v(" "),a("h3",{attrs:{id:"读取服务端文件"}},[t._v("读取服务端文件 "),a("a",{staticClass:"header-anchor",attrs:{href:"#读取服务端文件"}},[t._v("#")])]),t._v(" "),a("p",[t._v("目标网站发现如下链接："),a("code",[t._v("http://www.xx.com/down.php?file=/updown/1.txt")])]),t._v(" "),a("p",[t._v("在"),a("strong",[t._v("file参数")]),t._v("后尝试下载index.php首页文件，然后在首页文件继续找其它配置文件，获取数据库配置信息等。")]),t._v(" "),a("h2",{attrs:{id:"防护方法"}},[t._v("防护方法 "),a("a",{staticClass:"header-anchor",attrs:{href:"#防护方法"}},[t._v("#")])]),t._v(" "),a("blockquote",[a("p",[t._v("php.ini配置open_basedir限定文件访问范围")]),t._v(" "),a("p",[t._v("过滤.(点)，使用户在url中不能回溯上级目录")]),t._v(" "),a("p",[t._v("正则严格判断用户输入参数的格式")])]),t._v(" "),a("h2",{attrs:{id:"代码审计方法"}},[t._v("代码审计方法 "),a("a",{staticClass:"header-anchor",attrs:{href:"#代码审计方法"}},[t._v("#")])]),t._v(" "),a("p",[a("strong",[t._v("关注以下函数：")])]),t._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file_get_contents")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//将整个文件读入一个字符串")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("highlight_file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//语法高亮一个文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fopen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//打开文件或者 URL")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//把整个文件读取入一个数组")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//读取文件并写入到输出缓冲")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//读取文件（可安全用于二进制文件）")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fgets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//从文件指针中读取一行")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fgetss")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//从文件指针中读取一行并过滤掉 HTML 标记")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse_ini_file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//解析一个配置文件，返回一个联合数组")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("show_source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//highlight_file()的别名")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("h1",{attrs:{id:"任意文件删除漏洞"}},[t._v("任意文件删除漏洞 "),a("a",{staticClass:"header-anchor",attrs:{href:"#任意文件删除漏洞"}},[t._v("#")])]),t._v(" "),a("p",[t._v("关注函数：")]),t._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlink")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("相关漏洞："),a("a",{attrs:{href:"https://vulhub.org/#/environments/discuz/x3.4-arbitrary-file-deletion/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Discuz!X ≤3.4 任意文件删除漏洞"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);